import { createRef, useEffect } from "react";

import { Inter } from "next/font/google";
import Head from "next/head";

import { MissileController } from "domain/missile/missile.controller";

import styles from "styles/Home.module.css";

import { ExplodeFactory } from "domain/explode/explode.factory";
import { MissileFactory } from "domain/missile/missile.factory";
import { MissileModel } from "domain/missile/missile.model";
import { km1200hour } from "domain/mocks/speed.mocks";

const inter = Inter({ subsets: ["latin"] });

const missiles: MissileModel[] = [];

export default function Home() {
    const missilesRef = createRef<HTMLDivElement>();

    useEffect(() => {
        const missilesDiv = missilesRef.current;
        if (!missilesDiv) return;

        const explodesFactory = new ExplodeFactory();
        const missileFactory = new MissileFactory(missilesDiv);

        const controller = new MissileController(
            missileFactory,
            explodesFactory
        );

        // for(var i = 0; i < 10; i++) {
        //     const randX = Math.floor(Math.random() * window.innerWidth);
        //     const randY = Math.floor(Math.random() * window.innerHeight);

        //     const missile = controller.create(km1200hour, {
        //         x: randX,
        //         y: randY,
        //     })

        //     missiles.push(missile);
        // }

        document.addEventListener("mousemove", async(e) => {
            const missile1 = controller.create(km1200hour, {
                x: window.innerWidth / 2,
                y: window.innerHeight / 2,
            });

            const missile2 = controller.create(km1200hour, {
                x: e.clientX,
                y: e.clientY,
            });


            await controller.launch(missile1, missile2.coords);
            await controller.explode(missile1, missile2);
        });

        // const fuckThatShit = async () => {
        //     missiles.forEach(async (_, i) => {
        //         if (i === 0) return;

        //         const missile1 = missiles[i - 1];
        //         const missile2 = missiles[i];

        //         await controller.launch(missile1, missile2.coords);
        //         await controller.explode(missile1, missile2);
        //     });
        // };

        // fuckThatShit();
    }, [missilesRef]);

    return (
        <>
            <Head>
                <title>Create Next App</title>
                <meta
                    name="description"
                    content="Generated by create next app"
                />
                <meta
                    name="viewport"
                    content="width=device-width, initial-scale=1"
                />
                <link rel="icon" href="/favicon.ico" />
            </Head>

            <main className={styles.main}>
                <div id="missiles" ref={missilesRef}></div>
                <div id="explodes"></div>
            </main>
        </>
    );
}
